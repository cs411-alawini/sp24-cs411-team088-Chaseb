/* To find nearby users' advertisements based on their location relative to a specific user (like user_id = 1) */
SELECT ad.ad_id, ad.title, ua.user_id, ua.user_name, loc.city_name, 
       SQRT(POW(loc.latitude - user_loc.latitude, 2) + POW(loc.longitude - user_loc.longitude, 2)) AS euclidean_distance
FROM advertisement ad
JOIN user_account ua ON ad.user_id = ua.user_id
JOIN location loc ON ua.location_id = loc.location_id
JOIN (
    SELECT l.latitude, l.longitude
    FROM user_account u
    JOIN location l ON u.location_id = l.location_id
    WHERE u.user_id = 1
) AS user_loc
ORDER BY euclidean_distance ASC;
